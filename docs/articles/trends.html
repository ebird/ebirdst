<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>eBird Trends Data Products • ebirdst</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="eBird Trends Data Products">
<meta property="og:description" content="ebirdst">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ebirdst</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.2022.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/ebirdst.html">Get Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/status.html">Introduction to eBird Status Data Products</a>
    </li>
    <li>
      <a href="../articles/rasters.html">eBird Status Data Products Applications</a>
    </li>
    <li>
      <a href="../articles/trends.html">eBird Trends Data Products</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li>
  <a href="../articles/product-changelog.html#2020-changelog">Changelog</a>
</li>
<li>
  <a href="../news/index.html">Version History</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ebird/ebirdst/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>eBird Trends Data Products</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ebird/ebirdst/blob/HEAD/vignettes/trends.Rmd" class="external-link"><code>vignettes/trends.Rmd</code></a></small>
      <div class="hidden name"><code>trends.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.table {
    width: 75%;
}
</style>
<p>The eBird Trends Data Products provide estimates of trends in
relative abundance based on eBird data. Trend estimates are made on a 27
km by 27 km grid for a single season per species (breeding,
non-breeding, or resident). For further details on the methodology used
to estimate these trends consult the associated paper:</p>
<blockquote>
Fink, D., Johnston, A., Strimas-Mackey, M., Auer, T., Hochachka, W. M.,
Ligocki, S., Oldham Jaromczyk, L., Robinson, O., Wood, C., Kelling, S.,
&amp; Rodewald, A. D. (2023). A Double machine learning trend model for
citizen science data. Methods in Ecology and Evolution, 00, 1–14. <a href="https://doi.org/10.1111/2041-210X.14186" class="external-link uri">https://doi.org/10.1111/2041-210X.14186</a>
</blockquote>
<p>Data users who are not comfortable in R should consider directly
downloading the data from the <a href="https://science.ebird.org/en/status-and-trends/download-data" class="external-link">eBird
Status and Trends website</a>.</p>
<p>The data frame <code>ebirdst_runs</code> indicates which species have
trends estimates with the <code>has_trends</code> column. We can filter
the data frame and only select those columns relevant to trends.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ebird/ebirdst" class="external-link">ebirdst</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">trends_runs</span> <span class="op">&lt;-</span> <span class="va">ebirdst_runs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">has_trends</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species_code</span>, <span class="va">common_name</span>,</span>
<span>         <span class="va">trends_season</span>, <span class="va">trends_region</span>,</span>
<span>         <span class="va">trends_start_year</span>, <span class="va">trends_end_year</span>,</span>
<span>         <span class="va">trends_start_date</span>, <span class="va">trends_end_date</span>,</span>
<span>         <span class="va">rsquared</span>, <span class="va">beta0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">trends_runs</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 853</span></span>
<span><span class="co">#&gt; Columns: 10</span></span>
<span><span class="co">#&gt; $ species_code      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "abetow", "acafly", "acowoo", "aldfly", "alepar2", "…</span></span>
<span><span class="co">#&gt; $ common_name       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Abert's Towhee", "Acadian Flycatcher", "Acorn Woodp…</span></span>
<span><span class="co">#&gt; $ trends_season     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "resident", "breeding", "resident", "breeding", "res…</span></span>
<span><span class="co">#&gt; $ trends_region     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "north_america", "north_america", "north_america", "…</span></span>
<span><span class="co">#&gt; $ trends_start_year <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2012, 2012, 2011, 2012, 2015, 2012, 2011, 2011, 2012…</span></span>
<span><span class="co">#&gt; $ trends_end_year   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 2022, 2022, 2021, 2022, 2022, 2022, 2021, 2021, 2022…</span></span>
<span><span class="co">#&gt; $ trends_start_date <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "01-25", "05-24", "11-01", "06-21", "07-26", "03-22"…</span></span>
<span><span class="co">#&gt; $ trends_end_date   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "05-10", "08-02", "05-03", "07-12", "12-06", "06-07"…</span></span>
<span><span class="co">#&gt; $ rsquared          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 0.9231821, 0.8570363, 0.8805367, 0.7868723, 0.819570…</span></span>
<span><span class="co">#&gt; $ beta0             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> -0.013923012, 0.689424792, -0.092670714, -0.16241275…</span></span></code></pre></div>
<p>Information is provided on the trends model for each species,
including two predictive performance metrics (<code>rsquared</code> and
<code>beta0</code>) that are based on a comparison of actual and
estimated trends for a suite of simulations (see Fink et al. 2023 for
further details). The columns in the <code>trends_runs</code> data frame
are as follows:</p>
<ul>
<li>
<code>species_code</code>: the alphanumeric eBird species code
uniquely identifying the species.</li>
<li>
<code>common_name</code>: the English common name of the
species.</li>
<li>
<code>trends_season</code>: season that the trend was estimated for:
breeding, nonbreeding, or resident.</li>
<li>
<code>trends_region</code>: the geographic region that the trend
model was run for. Note that broadly distributed species (e.g. Barn
Swallow) will only have trend estimates for a regional subset of their
full range.</li>
<li>
<code>trends_start_year/trends_end_year</code>: the start and end
years of the trend time period.</li>
<li>
<code>trends_start_date/trends_end_date</code>: the start and end
dates (<code>MM-DD</code> format) of the season for which the trend was
estimated.</li>
<li>
<code>rsquared</code>: R-squared value comparing the actual and
estimated trends from the simulations.</li>
<li>
<code>beta0</code>: the intercept of a linear model fitting actual
vs. estimated trends (<code>actual ~ estimated</code>) for the
simulations. Positive values of <code>beta0</code> indicate that the
models are systematically <em>underestimating</em> the simulated trend
for this species.</li>
</ul>
<p>Note that some season dates span two calendar years, for example
Canvasback has 2011-2021 trends estimates for a non-breeding season
defined as December 20 to January 25. In this case, the first season
will be December 20, 2011 to January 25, 2012.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_runs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">common_name</span> <span class="op">==</span> <span class="st">"Canvasback"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">trends_start_year</span>, <span class="va">trends_end_year</span>, </span>
<span>         <span class="va">trends_start_date</span>, <span class="va">trends_end_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   trends_start_year trends_end_year trends_start_date trends_end_date</span></span>
<span><span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              <span style="text-decoration: underline;">2</span>011            <span style="text-decoration: underline;">2</span>021 12-20             01-25</span></span></code></pre></div>
<div class="section level2">
<h2 id="download">Downloading data<a class="anchor" aria-label="anchor" href="#download"></a>
</h2>
<p>Trends data access is granted through the same process as the eBird
Status Data Products. If you haven’t already requested an API key,
consult the relevant section in the <a href="https://ebird.github.io/ebirdst/articles/status.html#access">Introduction
to eBird Status Data Products vignette</a>.</p>
<p>Trends data can be downloaded for one or more species using
<code><a href="../reference/ebirdst_download_trends.html">ebirdst_download_trends()</a></code>, where the first argument is a
vector of common names, scientific names, or species codes. As with the
Status Data Products, trends data will be downloaded to a centralized
directory and file management and access is performed via `ebirdst. For
example, let’s download the breeding season trends data for Sage
Thrasher.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ebirdst_download_trends.html">ebirdst_download_trends</a></span><span class="op">(</span><span class="st">"Sage Thrasher"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load">Loading data into R<a class="anchor" aria-label="anchor" href="#load"></a>
</h2>
<p>Once the data are downloaded, the trends data for a set of species,
can be loaded into R using the function <code><a href="../reference/load_trends.html">load_trends()</a></code>. For
example, we can load the Sage Thrasher trends estimates we just
downloaded with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_sagthr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_trends.html">load_trends</a></span><span class="op">(</span><span class="st">"Sage Thrasher"</span><span class="op">)</span></span></code></pre></div>
<p>Each row corresponds to the trend estimate for a 27 km by 27 km grid
cell, identified by the <code>srd_id</code> column and with cell center
given by the <code>longitude</code> and <code>latitude</code>
coordinates. Columns beginning with <code>abd_ppy</code> provide
estimates of the percent per year trend in relative abundance and 80%
confidence intervals, while those beginning with <code>abd_trend</code>
provide estimates of the cumulative trend in relative abundance and 80%
confidence intervals over the time period. The <code>abd</code> column
gives the relative abundance estimate for the middle of the trend time
period (e.g. 2014 for a 2007-2021 trend). The
<code>start_year/end_year</code> and <code>start_date/end_date</code>
columns provide redundant information to that available in
<code>ebirdst_runs</code>. Specifically for Sage Thrasher we have:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_runs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">common_name</span> <span class="op">==</span> <span class="st">"Sage Thrasher"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">trends_start_year</span>, <span class="va">trends_end_year</span>,</span>
<span>         <span class="va">trends_start_date</span>, <span class="va">trends_end_date</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">#&gt;   trends_start_year trends_end_year trends_start_date trends_end_date</span></span>
<span><span class="co">#&gt;               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>              <span style="text-decoration: underline;">2</span>012            <span style="text-decoration: underline;">2</span>022 05-17             07-12</span></span></code></pre></div>
<p>This tells us that the trend estimates are for the breeding season
(May 17 to July 12) for the period 2012-2022.</p>
</div>
<div class="section level2">
<h2 id="spatial">Conversion to spatial formats<a class="anchor" aria-label="anchor" href="#spatial"></a>
</h2>
<p>The eBird trends data are stored in a tabular format, where each row
gives the trend estimate for a single cell in a 27 km by 27 km equal
area grid. For each grid cell, the coordinates (longitude and latitude)
are provided for the center of the grid cell. For many applications, an
explicitly spatial format is more useful and these coordinates can be
use to convert from the tabular format to either a vector or raster
format.</p>
<div class="section level3">
<h3 id="spatial-points">Vector (points)<a class="anchor" aria-label="anchor" href="#spatial-points"></a>
</h3>
<p>The tabular trend data can be converted into point vector features
for use with the <code>sf</code> package using the <code>sf</code>
function <code><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">trends_sagthr</span>, </span>
<span>                      coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, </span>
<span>                      crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trends_sf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 2462 features and 15 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -122.1784 ymin: 33.5256 xmax: -102.975 ymax: 49.35282</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2,462 × 16</span></span></span>
<span><span class="co">#&gt;    species_code season   start_year end_year start_date end_date srd_id      abd</span></span>
<span><span class="co">#&gt;  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">254</span>264 0.000<span style="text-decoration: underline;">527</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">255</span>764 0.014<span style="text-decoration: underline;">7</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">255</span>765 0.000<span style="text-decoration: underline;">214</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">257</span>264 0.001<span style="text-decoration: underline;">74</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">257</span>265 0.013<span style="text-decoration: underline;">2</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">257</span>266 0.001<span style="text-decoration: underline;">18</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">258</span>765 0.003<span style="text-decoration: underline;">35</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">258</span>766 0.019<span style="text-decoration: underline;">1</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">258</span>767 0.005<span style="text-decoration: underline;">11</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sagthr       breeding       <span style="text-decoration: underline;">2</span>012     <span style="text-decoration: underline;">2</span>022 05-17      07-12    <span style="text-decoration: underline;">260</span>264 0.000<span style="text-decoration: underline;">104</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2,452 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 8 more variables: abd_ppy &lt;dbl&gt;, abd_ppy_lower &lt;dbl&gt;, abd_ppy_upper &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abd_ppy_nonzero &lt;lgl&gt;, abd_trend &lt;dbl&gt;, abd_trend_lower &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   abd_trend_upper &lt;dbl&gt;, geometry &lt;POINT [°]&gt;</span></span></span></code></pre></div>
<p>These points can then be exported to GeoPackage for use in a GIS such
as QGIS or ArcGIS with</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># be sure to modify the path to the file to save the file to directory of </span></span>
<span><span class="co"># your choice on your hard drive</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">write_sf</a></span><span class="op">(</span><span class="va">trends_sf</span>, <span class="st">"ebird-trends_sagthr_2022.gpkg"</span>,</span>
<span>         layer <span class="op">=</span> <span class="st">"sagthr_trends"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="spatial-raster">Raster<a class="anchor" aria-label="anchor" href="#spatial-raster"></a>
</h3>
<p>The tabular trend estimates can most easily be converted to raster
format for use with the <code>terra</code> package using the function
<code><a href="../reference/rasterize_trends.html">rasterize_trends()</a></code>. Any of the columns in the trends data
frame can be selected using the <code>layers</code> argument and
converted into layers in the resulting raster object.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rasterize the percent per year trend with confidence limits (default)</span></span>
<span><span class="va">ppy_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize_trends.html">rasterize_trends</a></span><span class="op">(</span><span class="va">trends_sagthr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">ppy_raster</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 67, 100, 3  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 26665.26, 26665.28  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -10602273, -7935747, 3714548, 5501122  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; names       :   abd_ppy, abd_ppy_lower, abd_ppy_upper </span></span>
<span><span class="co">#&gt; min values  : -14.62142,     -17.52655,     -11.48219 </span></span>
<span><span class="co">#&gt; max values  :  13.62980,      11.74418,      15.77865</span></span>
<span><span class="co"># rasterize the cumulative trend estimate</span></span>
<span><span class="va">trends_raster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rasterize_trends.html">rasterize_trends</a></span><span class="op">(</span><span class="va">trends_sagthr</span>, layers <span class="op">=</span> <span class="st">"abd_trend"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trends_raster</span><span class="op">)</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 67, 100, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 26665.26, 26665.28  (x, y)</span></span>
<span><span class="co">#&gt; extent      : -10602273, -7935747, 3714548, 5501122  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : +proj=sinu +lon_0=0 +x_0=0 +y_0=0 +R=6371007.181 +units=m +no_defs </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; name        : abd_trend </span></span>
<span><span class="co">#&gt; min value   : -79.41793 </span></span>
<span><span class="co">#&gt; max value   : 258.85772</span></span></code></pre></div>
<p>These raster objects can be exported to GeoTIFF files for use in a
GIS such as QGIS or ArcGIS with</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">trends_raster</span>, filename <span class="op">=</span> <span class="st">"ebird-trends_sagthr_2021.tif"</span><span class="op">)</span></span></code></pre></div>
<p>A simple map of these data can be produced from the raster data. For
example, we’ll make a map of percent per year change in relative
abundance for Sage Thrasher. Note that this is slightly different than
the trends maps on the Status and Trends website, which show the
cumulative trend rather than the annual trend.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define breaks and palettes similar to those on status and trends website</span></span>
<span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">breaks</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="cn">Inf</span></span>
<span><span class="va">breaks</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebirdst_palettes.html">ebirdst_palettes</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">breaks</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, type <span class="op">=</span> <span class="st">"trends"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a simple map</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ppy_raster</span><span class="op">[[</span><span class="st">"abd_ppy"</span><span class="op">]</span><span class="op">]</span>, </span>
<span>     col <span class="op">=</span> <span class="va">pal</span>, breaks <span class="op">=</span>  <span class="va">breaks</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Sage Thrasher breeding trend 2012-2022 [% change per year]"</span>,</span>
<span>     cex.main <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>     axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="trends_files/figure-html/spatial-raster-map-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="uncertainty">Uncertainty<a class="anchor" aria-label="anchor" href="#uncertainty"></a>
</h2>
<p>The model used to estimate trends produces an ensemble of 100
estimates at each location, each based on a random subsample of eBird
data. This ensemble of estimates is used to quantify uncertainty in the
trends estimates. The estimated trend is the median across the ensemble,
and the 80% confidence intervals are the lower 10th and upper 90th
percentiles across the ensemble. Those wishing to access estimates from
the individual folds making up the ensemble can use
<code>fold_estimates = TRUE</code> when loading data. These fold-level
estimates can be used to quantify uncertainty, for example, when
calculating the trend for a given region. For example, let’s load the
fold-level estimates for Sage Thrasher:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_sagthr_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_trends.html">load_trends</a></span><span class="op">(</span><span class="st">"sagthr"</span>, fold_estimates <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trends_sagthr_folds</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 246,200 × 8</span></span></span>
<span><span class="co">#&gt;    species_code season    fold srd_id latitude longitude      abd abd_ppy</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> sagthr       breeding     1 <span style="text-decoration: underline;">254</span>264     49.4     -<span style="color: #BB0000;">120.</span> 0.000<span style="text-decoration: underline;">527</span>  -<span style="color: #BB0000;">3.11</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> sagthr       breeding     1 <span style="text-decoration: underline;">255</span>764     49.1     -<span style="color: #BB0000;">120.</span> 0.014<span style="text-decoration: underline;">7</span>    -<span style="color: #BB0000;">2.97</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> sagthr       breeding     1 <span style="text-decoration: underline;">255</span>765     49.1     -<span style="color: #BB0000;">119.</span> 0.000<span style="text-decoration: underline;">214</span>  -<span style="color: #BB0000;">2.25</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> sagthr       breeding     1 <span style="text-decoration: underline;">257</span>264     48.9     -<span style="color: #BB0000;">120.</span> 0.001<span style="text-decoration: underline;">74</span>   -<span style="color: #BB0000;">4.53</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> sagthr       breeding     1 <span style="text-decoration: underline;">257</span>265     48.9     -<span style="color: #BB0000;">120.</span> 0.013<span style="text-decoration: underline;">2</span>    -<span style="color: #BB0000;">3.86</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> sagthr       breeding     1 <span style="text-decoration: underline;">257</span>266     48.9     -<span style="color: #BB0000;">119.</span> 0.001<span style="text-decoration: underline;">18</span>   -<span style="color: #BB0000;">4.04</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> sagthr       breeding     1 <span style="text-decoration: underline;">258</span>765     48.6     -<span style="color: #BB0000;">120.</span> 0.003<span style="text-decoration: underline;">35</span>   -<span style="color: #BB0000;">3.08</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> sagthr       breeding     1 <span style="text-decoration: underline;">258</span>766     48.6     -<span style="color: #BB0000;">119.</span> 0.019<span style="text-decoration: underline;">1</span>    -<span style="color: #BB0000;">0.459</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> sagthr       breeding     1 <span style="text-decoration: underline;">258</span>767     48.6     -<span style="color: #BB0000;">119.</span> 0.005<span style="text-decoration: underline;">11</span>   -<span style="color: #BB0000;">6.40</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> sagthr       breeding     1 <span style="text-decoration: underline;">260</span>264     48.4     -<span style="color: #BB0000;">120.</span> 0.000<span style="text-decoration: underline;">104</span>  -<span style="color: #BB0000;">2.71</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 246,190 more rows</span></span></span></code></pre></div>
<p>This data frame is much more concise, only giving estimates of the
mid-point relative abundance and percent per year trend in relative
abundance for each of 100 folds for each grid cell.</p>
<div class="section level3">
<h3 id="applications-regional">Regional trends<a class="anchor" aria-label="anchor" href="#applications-regional"></a>
</h3>
<p>eBird trend estimates are made on a 27 km by 27 km grid, which allows
summarization over broader regions such as states or provinces. Since
the relative abundance of a species varies throughout its range, we need
to weight the mean trend calculation by relative abundance
(<code>abd</code> in the trends data frame). To quantify uncertainty in
the regional trend, we can use the fold-level data to produce 100
distinct estimates of the regional trend, then calculate the median and
80% confidence intervals. As an example, let’s calculate the state-level
mean percent per year trends in relative abundance for Sage
Thrasher.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># boundaries of states in the united states</span></span>
<span><span class="va">states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_states.html" class="external-link">ne_states</a></span><span class="op">(</span>iso_a2 <span class="op">=</span> <span class="st">"US"</span>, returnclass <span class="op">=</span> <span class="st">"sf"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso_a2</span> <span class="op">==</span> <span class="st">"US"</span>, <span class="op">!</span><span class="va">postal</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AK"</span>, <span class="st">"HI"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/transmute.html" class="external-link">transmute</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">iso_3166_2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert fold-level trends estimates to sf format</span></span>
<span><span class="va">trends_sagthr_sf</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">trends_sagthr_folds</span>, </span>
<span>                              coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>, </span>
<span>                              crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># attach state to the fold-level trends data</span></span>
<span><span class="va">trends_sagthr_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">trends_sagthr_sf</span>, <span class="va">states</span>, left <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># abundance-weighted average trend by region and fold</span></span>
<span><span class="va">trends_states_folds</span> <span class="op">&lt;-</span> <span class="va">trends_sagthr_sf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">fold</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>abd_ppy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">abd</span> <span class="op">*</span> <span class="va">abd_ppy</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">abd</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summarize across folds for each state</span></span>
<span><span class="va">trends_states</span> <span class="op">&lt;-</span> <span class="va">trends_states_folds</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>abd_ppy_median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">abd_ppy</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            abd_ppy_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">abd_ppy</span>, <span class="fl">0.10</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            abd_ppy_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">abd_ppy</span>, <span class="fl">0.90</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">abd_ppy_median</span><span class="op">)</span></span></code></pre></div>
<p>We can join these state-level trends back to the state boundaries and
make a map with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_states_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">states</span>, <span class="va">trends_states</span>, by <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">trends_states_sf</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">abd_ppy_median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Reds"</span>, </span>
<span>                       limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                       na.value <span class="op">=</span> <span class="st">"grey80"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"top"</span>, barwidth <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sage Thrasher state-level breeding trends 2012-2022"</span>,</span>
<span>       fill <span class="op">=</span> <span class="st">"Relative abundance trend [% change / year]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="trends_files/figure-html/unnamed-chunk-1-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>Based on these data, Sage Thrasher populations appear to be in
decline throughout their entire range; however, some states (e.g. South
Dakota) are experiencing much steeper declines than others
(e.g. California).</p>
</div>
<div class="section level3">
<h3 id="applications-multi">Multi-species trends<a class="anchor" aria-label="anchor" href="#applications-multi"></a>
</h3>
<p>In some cases, we may be interested in the trend for an entire
community of birds, which can be estimated by calculating the cell-wise
mean trend across a suite of species. For example, the eBird Trends Data
Products contain trend estimates for three species that breed in <a href="https://en.wikipedia.org/wiki/Sagebrush_steppe" class="external-link">sagebrush</a>:
Brewer’s Sparrow, Sagebrush Sparrow, and Sage Thrasher. We can calculate
an average trend for this group of species, which will provide an
estimate of the trend in the sagebrush bird community. First let’s look
at the model information to ensure all species are modeled for the same
region, season, and range of years.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sagebrush_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Brewer's Sparrow"</span>, <span class="st">"Sagebrush Sparrow"</span>, <span class="st">"Sage Thrasher"</span><span class="op">)</span></span>
<span><span class="va">trends_runs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">common_name</span> <span class="op"><a href="https://rdrr.io/pkg/terra/man/match.html" class="external-link">%in%</a></span> <span class="va">sagebrush_species</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 10</span></span></span>
<span><span class="co">#&gt;   species_code common_name       trends_season trends_region trends_start_year</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> brespa       Brewer's Sparrow  breeding      north_america              <span style="text-decoration: underline;">2</span>012</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> sagspa1      Sagebrush Sparrow breeding      north_america              <span style="text-decoration: underline;">2</span>012</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> sagthr       Sage Thrasher     breeding      north_america              <span style="text-decoration: underline;">2</span>012</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: trends_end_year &lt;dbl&gt;, trends_start_date &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   trends_end_date &lt;chr&gt;, rsquared &lt;dbl&gt;, beta0 &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Everything looks good, so we can proceed to compare trends for these
species. Next we need to download the trends data for these species.
Note that since we’ve already downloaded the Sage Thrasher data above it
won’t be re-downloaded here.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ebirdst_download_trends.html">ebirdst_download_trends</a></span><span class="op">(</span><span class="va">sagebrush_species</span><span class="op">)</span></span></code></pre></div>
<p>Now we can load the trends and calculate the cell-wise mean.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trends_sagebrush_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_trends.html">load_trends</a></span><span class="op">(</span><span class="va">sagebrush_species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># calculate mean trend for each cell</span></span>
<span><span class="va">trends_sagebrush</span> <span class="op">&lt;-</span> <span class="va">trends_sagebrush_species</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">srd_id</span>, <span class="va">latitude</span>, <span class="va">longitude</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>n_species <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>            abd_ppy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">abd_ppy</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>            .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">trends_sagebrush</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,265 × 5</span></span></span>
<span><span class="co">#&gt;    srd_id latitude longitude n_species abd_ppy</span></span>
<span><span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> <span style="text-decoration: underline;">234</span>764     52.5     -<span style="color: #BB0000;">118.</span>         1  -<span style="color: #BB0000;">8.61</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> <span style="text-decoration: underline;">234</span>765     52.5     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">7.91</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> <span style="text-decoration: underline;">234</span>766     52.5     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">6.30</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> <span style="text-decoration: underline;">236</span>265     52.2     -<span style="color: #BB0000;">118.</span>         1  -<span style="color: #BB0000;">0.521</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> <span style="text-decoration: underline;">236</span>266     52.2     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">6.90</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> <span style="text-decoration: underline;">236</span>267     52.2     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">6.56</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> <span style="text-decoration: underline;">236</span>268     52.2     -<span style="color: #BB0000;">116.</span>         1  -<span style="color: #BB0000;">5.27</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> <span style="text-decoration: underline;">237</span>765     52.0     -<span style="color: #BB0000;">118.</span>         1  -<span style="color: #BB0000;">5.89</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> <span style="text-decoration: underline;">237</span>766     52.0     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">5.68</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> <span style="text-decoration: underline;">237</span>767     52.0     -<span style="color: #BB0000;">117.</span>         1  -<span style="color: #BB0000;">9.76</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3,255 more rows</span></span></span></code></pre></div>
<p>Finally, let’s make a map of these sagebrush trends, focusing only on
those cells where all three species occur.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert the points to sf format</span></span>
<span><span class="va">all_species</span> <span class="op">&lt;-</span> <span class="va">trends_sagebrush</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_species</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sagebrush_species</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span>,</span>
<span>           crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make a map</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">all_species</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">abd_ppy</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"#CB181D"</span>, high <span class="op">=</span> <span class="st">"#2171B5"</span>,</span>
<span>                        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>, </span>
<span>                        oob <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/oob.html" class="external-link">oob_squish</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title.position <span class="op">=</span> <span class="st">"left"</span>, barheight <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Sagebrush species breeding trends (2012-2022)"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Relative abundance trend [% change / year]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="trends_files/figure-html/applications-multi-map-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="http://strimas.com" class="external-link">Matthew Strimas-Mackey</a>, Shawn Ligocki, <a href="http://twitter.com/tom_auer" class="external-link">Tom Auer</a>, Daniel Fink.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
